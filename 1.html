<template>
    <div id="body">
      <div id="bg"></div>
      <div id="header">
        <div class="back-btn" @click="back()"></div>
        <div class="input-box">
          <div class="search-btn"></div>
          <input
            @click="suggest()"
            class="search-box"
            type="text"
            autofocus="autofocus"
            placeholder="输入店铺名称或商品名称"
          >
        </div>
      </div>
      <div id="kind">
        <ul>
          <li :class="listType=='zh'?'on':''" @click="changeType('zh')">综合</li>
          <li :class="listType=='xll'?'on':''" @click="changeType('xll')">销量</li>
          <li :class="listType=='pf'?'on':''" @click="changeType('pf')">评分</li>
        </ul>
      </div>
      <div id="bottom">
        <touch-scroll
          ref="noticeRef"
          :pullup="isShow"
          :pulldown="isShow"
          @pulldown="loadPage"
          @scrollToEnd="loadUp"
        >
          <ul class="goods-list" v-for="(i,index1) in list" :key="index1">
            <li v-for="(item,index2) in i" :key="index2">
              <div class="detail">
                <div class="title">
                  <span>{{item.storeName}}</span>
                  <span>({{item.cost}})</span>
                  <div @click="intoStore(item.goodsId)">进店</div>
                </div>
                <div class="xl">
                  <span>月销量{{item.goodsNo}}</span>丨
                  <span>评分{{item.goodsId}}</span>
                </div>
                <ul class="picture-box">
                  <li>
                    <img src="/static/img/temp/temp-5.jpg" @click="goDetail(item.goodsId)">
                    <span>￥{{item.mktprice}}</span>
                  </li>
                  <li>
                    <img src="/static/img/temp/temp-5.jpg" @click="goDetail(item.goodsId)">
                    <span>￥{{item.mktprice}}</span>
                  </li>
                  <li>
                    <img src="/static/img/temp/temp-5.jpg" @click="goDetail(item.goodsId)">
                    <span>￥{{item.mktprice}}</span>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </touch-scroll>
      </div>
    </div>
  </template>
  <script>
  import axios from "axios";
  import TouchScroll from "@/components/common/commonScroll.vue";
  export default {
    name: "storecont",
    components: {
      TouchScroll
    },
    data() {
      return {
        listType: "zh",
        list: [],
  
        isShow: true,
        page: {
          pageNo: 1,
          pageSize: 10
        },
        pageData: {},
        totalPage: 1,
        loading: true,
        loadEnd: false
      };
    },
    mounted() {
      this.loadPage();
    },
    methods: {
      changeType(con) {
        this.listType = con;
      },
      back() {
        window.history.go(-1);
      },
      intoStore(id) {
        this.$router.push("/store/" + id);
      },
      suggest() {
        this.$router.push("/search");
      },
      goDetail(id) {
        this.$router.push("/goodsDetail/" + id);
      },
      loadPage() {
        this.list = [];
        this.$refs.noticeRef.$emit("pullrefresh.finishLoad");
        this.getList(1);
      },
      loadUp() {
        if (!this.page.pageNo) return;
        if (this.page.pageNo < this.totalPage) {
          this.page.pageNo++;
          this.getList(this.page.pageNo);
          if (this.page.pageNo == this.totalPage) {
            this.$refs.noticeRef.$emit("infinitescroll.loadedDone");
          } else {
            this.$refs.noticeRef.$emit("infinitescroll.reInit");
          }
        } else {
          this.$refs.noticeRef.$emit("infinitescroll.loadedDone");
        }
      },
      getList(page) {
        this.page.pageNo = page;
        this.$http
          .get("/goodsKey?pageNo=" + page + "&pageSize=" + this.page.pageSize)
          .then(res => {
            if (res.data.result.status) {
              const resArr = res.data.data.goodsList;
              this.pageData = res.data.page;
  
              if (resArr.length === 0 && this.page.pageNo === 1) {
                this.isShow = false;
              } else {
                this.isShow = true;
              }
              this.totalPage = this.pageData.pageSum;
              if (this.page.pageNo === 1 && resArr.length < this.page.pageSize) {
                this.$refs.noticeRef.$emit("infinitescroll.loadedDone");
              }
              if (resArr.length > 0) {
                this.list.push(resArr);
              }
            } else {
              this.$messagebox({
                showClose: true,
                message: res.data.result.msg,
                type: "error"
              });
            }
          });
      }
    }
  };
  </script>
  <style scoped>
  .on {
    color: #169be8;
  }
  #body {
    margin: 0;
    padding: 0;
  }
  #bg {
    height: 0.18rem;
  
    background: white;
  }
  #header {
    display: flex;
    position: relative;
  
    /* margin-top:0.18rem; */
  }
  #header .back-btn {
    width: 0.3rem;
    height: 0.3rem;
    border-top: 1px solid #333333;
    border-left: 1px solid #333333;
    transform: rotate(-45deg);
    position: absolute;
    left: 0.26rem;
    top: 0.2rem;
    float: left;
  }
  #header .input-box {
    position: relative;
    margin-left: 0.78rem;
    width: 6.42rem;
    height: 0.68rem;
    display: flex;
    justify-content: center;
    background: #f4f4f6;
    border-radius: 1.96rem;
  }
  .input-box .search-btn {
    position: absolute;
    left: 0.31rem;
    top: 0.2rem;
    background: url(/static/img/icon-search.png) no-repeat;
    width: 0.368rem;
    height: 0.368rem;
    background-size: 100% auto;
  }
  .input-box input {
    position: absolute;
    left: 0.84rem;
    top: 0.18rem;
    font-family: PingFangSC-Regular;
    font-size: 0.28rem;
    color: #bfbfbf;
    letter-spacing: 0;
    line-height: 0.28rem;
    outline: none;
    border: 0;
    background-color: rgba(0, 0, 0, 0);
  }
  #kind ul {
    position: relative;
  }
  #kind {
    margin-top: 0.18rem;
    height: 0.88rem;
    background: #ffffff;
    border: 1px solid #f1f1f1;
    position: relative;
  }
  #kind ul li {
    float: left;
  
    font-family: PingFangSC-Regular;
    font-size: 0.28rem;
    /* color: #333333; */
    letter-spacing: 0;
    text-align: center;
    line-height: 0.28rem;
  }
  li {
    list-style: none;
  }
  /* #kind ul li:hover{
  color: #169BE8;
  } */
  #kind ul li:nth-child(1) {
    position: absolute;
    left: 0.8rem;
    top: 0.3rem;
  }
  #kind ul li:nth-child(2) {
    position: absolute;
    left: 3.48rem;
    top: 0.3rem;
  }
  #kind ul li:nth-child(3) {
    position: absolute;
    left: 6.14rem;
    top: 0.3rem;
  }
  #bottom .goods-list > li {
    width: 7.1rem;
    height: 4.14rem;
    background: #ffffff;
    border-radius: 0.08rem;
    margin-top: 0.2rem;
    position: relative;
  }
  #bottom {
    background: #f6f6f7;
    display: flex;
    justify-content: center;
  }
  #bottom .goods-list li .detail {
    display: absolute;
    left: 0.2rem;
    top: 0.2rem;
  }
  .goods-list li .detail .picture dev {
    background: url(/static/img/icon-search.png) no-repeat;
    background-size: 100% auto;
    width: 2.088rem;
    height: 2.1rem;
  }
  .goods-list li .detail .title div {
    width: 0.88rem;
    height: 0.44rem;
    border: 0.5px solid #169be8;
    border-radius: 0.08rem;
    font-family: PingFangSC-Regular;
    font-size: 0.24rem;
    color: #169be8;
    letter-spacing: 0;
    /* line-height: 0.44rem; */
    text-align: center;
    position: absolute;
    right: 0.5rem;
    top: 0px;
  }
  .goods-list li .detail {
    position: relative;
  }
  .goods-list li .detail .title span:nth-child(1) {
    font-family: PingFangSC-Medium;
    font-size: 0.28rem;
    color: #000000;
    font-weight: bold;
    letter-spacing: 0;
    line-height: 0.28rem;
  }
  .goods-list li .detail .title span:nth-child(2) {
    font-family: PingFangSC-Regular;
    font-size: 0.28rem;
    color: #151515;
    letter-spacing: 0;
    line-height: 0.28rem;
  }
  .goods-list li .detail .xl {
    font-family: PingFangSC-Regular;
    font-size: 0.24rem;
    color: #999999;
    letter-spacing: 0;
    line-height: 0.24rem;
    margin-top: 0.05rem;
  }
  .goods-list li .detail .picture-box img {
    width: 2.088rem;
    height: 2.1rem;
    background-size: 100% auto;
  }
  .goods-list li .detail .picture-box {
    display: flex;
    flex-direction: row;
    width: 6.7rem;
    height: 2.54rem;
    margin-top: 0.2rem;
  }
  .goods-list li .detail .picture-box span {
    font-family: PingFangSC-Medium;
    font-size: 0.28rem;
    color: #ff5722;
    letter-spacing: 0;
    line-height: 0.24rem;
  }
  </style>
  